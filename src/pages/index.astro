---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { Image } from  "astro:assets";
import Box from "../assets/box.png";
import Plus from "../assets/plus.png";
import "../styles/style.scss";
---

<style lang="scss">
.main-container {
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: #FBEFE0;
  overflow: hidden;
}

/* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼šä¸Šéƒ¨ã«å›ºå®š */
.input-form {
  position: sticky;
  top: 0;
  background: #FBEFE0;
  padding: 10px 20px;
  display: flex;
  justify-content: center;
  gap: 10px;
  z-index: 10;

  input {
    padding: 10px;
    font-size: 16px;
    width: 60%;
    background: #eee;
    border: none;
    border-radius: 4px;
  }
  button {
    background: #AE9890;
    color: white;
    border: none;
    padding: 10px 20px;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
  }
}

/* ToDoãƒªã‚¹ãƒˆ */
.todo-list {
  flex-grow: 1;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  padding-bottom: 100px;

  .todo-item {
    font-weight: bold;
    font-size: 18px;
    padding: 12px;
    border-bottom: 2px solid black;
    width: 80%;
    cursor: pointer;
    transition: background 0.3s;
  }

  .todo-item.selected {
    background: #f9bcbc;
  }
}

/* ãƒœã‚¿ãƒ³ã‚’ç”»é¢ä¸‹ã«å›ºå®š */
.btn-area {
  position: fixed;
  bottom: 20px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: center;
  gap: 40px;
  z-index: 100;

  img {
    width: 60px;
    height: 60px;
    background: #AE9890;
    border-radius: 50%;
    margin-bottom: 70px;
    padding: 10px;
    cursor: pointer;
  }
}
</style>

<Layout>
  <Header />
  <main class="main-container">
    <!-- å…¥åŠ›æ¬„ -->
    <div class="input-form">
      <input type="text" id="todo-input" placeholder="ã‚„ã‚‹ã“ã¨ã‚’æ›¸ã" />
      <button id="add-todo">è¿½åŠ </button>
    </div>

    <!-- ToDoãƒªã‚¹ãƒˆ -->
    <div id="todo-list" class="todo-list"></div>

    <!-- ä¸‹éƒ¨å›ºå®šã®æ“ä½œãƒœã‚¿ãƒ³ -->
    <div class="btn-area">
      <Image src={Box} alt="å‰Šé™¤" id="delete-button" />
      <Image src={Plus} alt="è¿½åŠ " id="add-button" />
    </div>
  </main>
  <Footer />

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("todo-input");
    const addBtn = document.getElementById("add-todo");
    const plusBtn = document.getElementById("add-button");
    const deleteBtn = document.getElementById("delete-button");
    const list = document.getElementById("todo-list");

    // ğŸ”¸ åˆæœŸåŒ–ï¼šãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã‚€
    let todos = JSON.parse(localStorage.getItem("todos") || "[]");
    todos.forEach(todo => createTodoItem(todo));

    // ğŸ”¹ ToDoè¿½åŠ ï¼ˆå…¥åŠ›æ¬„ or ä¸‹ã®è¿½åŠ ãƒœã‚¿ãƒ³ï¼‰
    function addTodo(text) {
      const newTodo = {
        id: Date.now(),
        text
      };
      todos.unshift(newTodo);
      saveTodos();
      createTodoItem(newTodo, true);
    }

    // ğŸ”¹ ToDo DOMã‚’ç”Ÿæˆ
    function createTodoItem(todo, prepend = false) {
      const todoEl = document.createElement("div");
      todoEl.className = "todo-item";
      todoEl.textContent = todo.text;
      todoEl.dataset.id = todo.id;

      // âœ… é¸æŠæ™‚ã«ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      todoEl.addEventListener("click", () => {
        const confirmed = window.confirm("å®Œäº†ã—ã¾ã—ãŸã‹ï¼Ÿ");
        if (confirmed) {
          todoEl.classList.toggle("selected");
        }
      });

      if (prepend) {
        list.prepend(todoEl);
      } else {
        list.appendChild(todoEl);
      }
    }

    // ğŸ”¸ å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®è¿½åŠ ãƒœã‚¿ãƒ³
    addBtn.addEventListener("click", () => {
      const text = input.value.trim();
      if (!text) return;
      addTodo(text);
      input.value = "";
    });

    // ğŸ”¹ ä¸‹ã®ãƒ—ãƒ©ã‚¹ãƒœã‚¿ãƒ³ã§å…¥åŠ›ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
    plusBtn.addEventListener("click", () => {
      input.focus();
    });

    // ğŸ”¸ å‰Šé™¤ãƒœã‚¿ãƒ³ã§é¸æŠé …ç›®ã‚’å‰Šé™¤
    deleteBtn.addEventListener("click", () => {
      const selectedEls = [...document.querySelectorAll(".todo-item.selected")];
      const selectedIds = selectedEls.map(el => Number(el.dataset.id));

      todos = todos.filter(todo => !selectedIds.includes(todo.id));
      selectedEls.forEach(el => el.remove());
      saveTodos();
    });

    // ğŸ”¸ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¿å­˜
    function saveTodos() {
      localStorage.setItem("todos", JSON.stringify(todos));
    }
  });
</script>

</Layout>
